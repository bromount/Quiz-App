<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{testCode}} Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <link rel="stylesheet" href="../static/quesitons.css">
</head>
<body>
    <div class="sticky-top sticky-sm-top Counter shadow p-1 bg-body-tertiary rounded">
      <span id="counter"></span>
        <div class="progress" role="progressbar" aria-label="Success example" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar bg-success" style="width: 100%"></div>
        </div>
    </div>
    
    <iframe src="../static/audios/silence.mp3" allow="autoplay" id="audio" style="display: none"></iframe>
    <audio controls id="player" autoplay style="width: 100%; margin-top: 15px;">
        <source src="../static/audios/{{audio}}"> 
    </audio>
    
    <div class="questions">
        <form action="" method="POST" id="Quiz">
        {% for i in testDetails %}
          <div>
              <div class="form-control">
                <label class="form-label">{{i['question_no']}}. {{i['question']}}</label>
              </div>
              <div class="options">
                  <input class="form-check-input" type="radio" name="option-{{i['question_no']}}" id="flexRadioDefault1" value="{{i['choice1']}}">
                  <label class="form-check-label" for="flexRadioDefault1">
                    {{i['choice1']}}
                  </label>
              </div>
              <div class="options">
                  <input class="form-check-input" type="radio" name="option-{{i['question_no']}}" id="flexRadioDefault1" value="{{i['choice2']}}">
                  <label class="form-check-label" for="flexRadioDefault1">
                    {{i['choice2']}}
                  </label>
              </div>
              <div class="options">
                  <input class="form-check-input" type="radio" name="option-{{i['question_no']}}" id="flexRadioDefault1" value="{{i['choice3']}}">
                  <label class="form-check-label" for="flexRadioDefault1">
                    {{i['choice3']}}
                  </label>
              </div>
              <div class="options">
                  <input class="form-check-input" type="radio" name="option-{{i['question_no']}}" id="flexRadioDefault1" value="{{i['choice4']}}">
                  <label class="form-check-label" for="flexRadioDefault1">
                    {{i['choice4']}}
                  </label>
              </div>
              <br>
        {% endfor %}
        <div class="d-flex justify-content-between">
          <button type="submit" value="Submit" id="sumbitButton" class="btn btn-lg btn-success">Submit</button>
        </div>
        </form>
    </div>



<script>
    function startTimer(duration, display) {
    var timer = duration, minutes, seconds;
    var counter = setInterval(function () {
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = minutes + ":" + seconds;

        if (--timer < 0) {
            timer = duration;
            function enable_disable(){
                // not("#sumbitButton")
                $("#Quiz :input").prop("disabled",true);
            };
            enable_disable();
            clearInterval(counter);
            alert("Time Up!")
        }

        if(minutes < 1){
            display.style.color = 'red'
        }
    }, 1000);
}


function progressBar(minutes){
    value = 100;
    sec = minutes*60;
    sub = sec/100;
    var progress = setInterval(function(){
        value--;
        document.querySelector(".progress-bar").style.width= `${value}%`;
        if(document.querySelector(".progress-bar").style.width == "10%"){
            document.querySelector(".progress-bar").classList.remove("bg-success");
            document.querySelector(".progress-bar").classList.add("bg-danger");
        }
    },1000);
    if (value <= 0){
        clearInterval(progress);
    }
}

window.onload = function () {
    var fiveMinutes = 60 * 10;
    display = document.getElementById('counter');
    Minutes = 10;
    startTimer(fiveMinutes, display);
    progressBar(Minutes);

    var isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
  if (!isChrome){
      $('#audio').remove()
  }
  else {
      $('#player').remove() // just to make sure that it will not have 2x audio in the background 
  }
};
</script>


</body>
</html>